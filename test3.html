<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>WIGO-혼자서 갈수있는 장소!</title>
  <link rel="stylesheet" href="headerStyle.css" />
  <link rel="stylesheet" href="starRating.css" />
  <style>
    section {
      padding-top: 150px;
    }
  </style>
  <script src="http://code.jquery.com/jquery-3.3.1.min.js"></script>

  <script>
    var district = localStorage.getItem("district");
    $(document).ready(function() {

      var $star = $(".star-input"),
        $result = $star.find("output>b");

      $(document)
        .on("focusin", ".star-input>.input",
          function() {
            $(this).addClass("focus");
          })
        .on("focusout", ".star-input>.input", function() {
          var $this = $(this);
          setTimeout(function() {
            if ($this.find(":focus").length === 0) {
              $this.removeClass("focus");
            }
          }, 100);
        })
        .on("change", ".star-input :radio", function() {
          $result.text($(this).next().text());
        })
        .on("mouseover", ".star-input label", function() {
          $result.text($(this).text());
        })
        .on("mouseleave", ".star-input>.input", function() {
          var $checked = $star.find(":checked");
          if ($checked.length === 0) {
            $result.text("0");
          } else {
            $result.text($checked.next().text());
          }
        });
      $("#input").click(function() {
        var $checked = $star.find(":checked");
        var str = localStorage.getItem("starScore");
        var nowScore = $checked.next().text();

        //alert("localStorage :"+ str);
        nowScore *=1;
        str *=1;
        var val = (str + nowScore) / 2;
        // alert("now :"+ nowScore);
        // alert("varl:" +val);
        remove('212');
        add('212' , val);
        read('212');
      });
    });

  </script>
  <script>
    //prefixes of implementation that we want to test
    window.indexedDB = window.indexedDB || window.mozIndexedDB || window.webkitIndexedDB || window.msIndexedDB;

    //prefixes of window.IDB objects
    window.IDBTransaction = window.IDBTransaction || window.webkitIDBTransaction || window.msIDBTransaction;
    window.IDBKeyRange = window.IDBKeyRange || window.webkitIDBKeyRange || window.msIDBKeyRange

    if (!window.indexedDB) {
      window.alert("Your browser doesn't support a stable version of IndexedDB.")
    }
    var str;
    var db;
    var request = window.indexedDB.open("newDatabase", 1);

    request.onerror = function(event) {
      console.log("error: ");
    };

    request.onsuccess = function(event) {
      db = request.result;
      console.log("success: " + db);
    };

    request.onupgradeneeded = function(event) {
      var db = event.target.result;
      var objectStore = db.createObjectStore("scores", {
        keyPath: "id"
      });
    }
    // function read() {
    //   var transaction = db.transaction(["customers"]);
    //   var objectStore = transaction.objectStore("customers");
    //   var request = objectStore.get("00-02");
    //   request.onerror = function(event) {
    //     alert("Unable to retrieve daa from database!");
    //   };
    //   request.onsuccess = function(event) {
    //     // Do something with the request.result!
    //     if (request.result) {
    //       alert("Name: " + request.result.name + ", Age: " + request.result.age + ", Email: " + request.result.email);
    //     } else {
    //       alert("Kenny couldn't be found in your database!");
    //     }
    //   };
    // }
    // function remove() {
    //
    //   var request = db.transaction(["customers"], "readwrite")
    //     .objectStore("customers")
    //     .delete("00-02");
    //   request.onsuccess = function(event) {
    //     alert("entry has been removed from your database.");
    //   };
    // }

    function read(key) {
      var transaction = db.transaction(["scores"]);
      var objectStore = transaction.objectStore("scores");
      var request = objectStore.get(key);
      request.onerror = function(event) {
        alert("Unable to retrieve daa from database!");
      };

      request.onsuccess = function(event) {
        // Do something with the request.result!
        if (request.result) {
          var num = request.result.score;
          localStorage.setItem("starScore", num.toFixed(1));
        //  alert("SCORE : " + request.result.score );
          document.getElementById("1").innerHTML = num.toFixed(1);
        } else {
          //alert("Kenny couldn't be found in your database!");
        }
      };
    }

    function test(i) {

      var transaction = db.transaction(["scores"]);
      var store = transaction.objectStore("scores");
      var getScore = store.get('212');

      getScore.onsuccess = function() {
        console.log(getScore.result.score); // => "John"
        document.getElementById(1).innerHTML = getScore.result.score;
      };
    }

    function readAll() {
      var objectStore = db.transaction("bestParkScores").objectStore("bestParkScores");
      var count;
      objectStore.openCursor().onsuccess = function(event) {
        var cursor = event.target.result;

        if (cursor) {
          count = cursor.key;
          alert("Name for id " + cursor.key + " is " + cursor.value.name + ", Scoore: " + cursor.value.score  );
          if (count == 0) {
            alert("hi");
          }
          count = count + 1;
          cursor.continue();
        } else {
          alert("No more entries!");
        }
      };
      alert(count);
    }
    function add(key, num) {
      var request = db.transaction(["scores"], "readwrite")
        .objectStore("scores")
        .add({
          id: key,
          score: num
        });

      request.onsuccess = function(event) {
        //alert("it has been added to your database.");
      };

      request.onerror = function(event) {
        alert("Unable to add data\r\nit is aready exist in your database! ");
      };

    }

    function remove(key) {

      var request = db.transaction(["scores"], "readwrite")
        .objectStore("scores")
        .delete(key);
      request.onsuccess = function(event) {
        //alert("entry has been removed from your database.");
      };
    }
  </script>
  <script>
    $(document).ready(function() {
      read('212');
    });
  </script>
</head>

<body>
  <!-- 1. 헤더 -->
  <header id="header">
    <form class="inputForm">
      <input type="text" value="아이디" />
      <input type="password" />
      <input type="submit" value="로그인" />
    </form>
    <a href="main.html"><img src="logo_wigo.png"  class="firstImage"/></a>
    <img src="logo_whereigo.png" class="secondImage" />
  </header>
  <!-- 3. 세션 -->
  <section class="section">
    <button onclick="read('212')">Read single data from indexedDb</button>
    <span class="star-input">
  	<span class="input">
      	<input type="radio" name="star-input" value="1" id="p1">
      	<label for="p1">1</label>
      	<input type="radio" name="star-input" value="2" id="p2">
      	<label for="p2">2</label>
      	<input type="radio" name="star-input" value="3" id="p3">
      	<label for="p3">3</label>
      	<input type="radio" name="star-input" value="4" id="p4">
      	<label for="p4">4</label>
      	<input type="radio" name="star-input" value="5" id="p5">
      	<label for="p5">5</label>
    	</span>
    <output for="star-input"><b>0</b>점</output>
    </span>
    <input type="button" value="별점 주기" id="input" />
    <br>
    <h2 id="1">TEST</h2>
    <hr/>
    <br>
    <!-- 라이브리 시티 설치 코드 -->
    <div id="lv-container" data-id="city" data-uid="MTAyMC8zNjg2Mi8xMzM5OA==">
      <script src="https://www.gstatic.com/firebasejs/5.0.4/firebase.js"></script>
      <script>
        // Initialize Firebase
        var config = {
          apiKey: "AIzaSyDb7Y0vXrXNvL3Y97gxG0yefK3QScRq1QU",
          authDomain: "wigotest-231d2.firebaseapp.com",
          databaseURL: "https://wigotest-231d2.firebaseio.com",
          projectId: "wigotest-231d2",
          storageBucket: "wigotest-231d2.appspot.com",
          messagingSenderId: "352491168261"
        };
        firebase.initializeApp(config);
        var provider = new firebase.auth.GoogleAuthProvider();

        // 인증하기
        firebase.auth().signInWithPopup(provider).then(function(result) {
          // This gives you a Google Access Token. You can use it to access the Google API.
          var token = result.credential.accessToken;
          // The signed-in user info.
          var user = result.user;

          console.log(user) // 인증 후 어떤 데이터를 받아오는지 확인해보기 위함.
          // ...
        }).catch(function(error) {
          // Handle Errors here.
          var errorCode = error.code;
          var errorMessage = error.message;
          // The email of the user's account used.
          var email = error.email;
          // The firebase.auth.AuthCredential type that was used.
          var credential = error.credential;
          // ...
        });
      </script>
      <script type="text/javascript">
        (function(d, s) {
          var j, e = d.getElementsByTagName(s)[0];

          if (typeof LivereTower === 'function') {
            return;
          }

          j = d.createElement(s);
          j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
          j.async = true;

          e.parentNode.insertBefore(j, e);
        })(document, 'script');
      </script>
      <noscript> 라이브리 댓글 작성을 위해 JavaScript를 활성화 해주세요</noscript>
    </div>
    <!-- 시티 설치 코드 끝 -->

  </section>
  <!-- 4. 바닥글 -->
  <footer>
  </footer>
</body>

</html>
