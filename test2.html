<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
  <meta charset="utf-8">
  <title></title>
  <script>

    //prefixes of implementation that we want to test
    window.indexedDB = window.indexedDB || window.mozIndexedDB || window.webkitIndexedDB || window.msIndexedDB;

    //prefixes of window.IDB objects
    window.IDBTransaction = window.IDBTransaction || window.webkitIDBTransaction || window.msIDBTransaction;
    window.IDBKeyRange = window.IDBKeyRange || window.webkitIDBKeyRange || window.msIDBKeyRange

    if (!window.indexedDB) {
      window.alert("Your browser doesn't support a stable version of IndexedDB.")
    }

    const customerData = [{
        id: "00-01",
        name: "Bill",
        age: 35,
        email: "bill@company.com"
      },
      {
        id: "00-02",
        name: "Donna",
        age: 32,
        email: "donna@home.org"
      }
    ];


    var db;
    var request = window.indexedDB.open("newDatabase", 1);

    request.onerror = function(event) {
      console.log("error: ");
    };

    request.onsuccess = function(event) {
      db = request.result;
      console.log("success: " + db);
    };

    request.onupgradeneeded = function(event) {
      var db = event.target.result;
      var objectStore = db.createObjectStore("customers", {
        keyPath: "id"
      });
      for (var i in customerData) {
        objectStore.add(customerData[i]);
      }
    }

    function read(index) {
      var transaction = db.transaction(["customers"]);
      var objectStore = transaction.objectStore("customers");
      var request = objectStore.get(index);
      request.onerror = function(event) {
        alert("Unable to retrieve daa from database!");
      };
      request.onsuccess = function(event) {
        // Do something with the request.result!
        if (request.result) {
          alert("Name: " + request.result.name + ", Age: " + request.result.age + ", Email: " + request.result.email);
        } else {
          alert("Kenny couldn't be found in your database!");
        }
      };
    }

    function readAll() {
      var objectStore = db.transaction("customers").objectStore("customers");
      var count = 0;
      objectStore.openCursor().onsuccess = function(event) {
        var cursor = event.target.result;

        if (cursor) {
          alert("Name for id " + cursor.key + " is " + cursor.value.name + ", Age: " + cursor.value.age + ", Email: " + cursor.value.email);
          if(count == 0){
            alert("hi");
          }
          count = count + 1;
          cursor.continue();
        } else {
          alert("No more entries!");
        }
      };
    }

    function add(index) {
      var request = db.transaction(["customers"], "readwrite")
        .objectStore("customers")
        .add({
          id: "00-03",
          name: "Kenny",
          age: index,
          email: "kenny@planet.org"
        });

      request.onsuccess = function(event) {
        alert("it has been added to your database.");
      };

      request.onerror = function(event) {
        alert("Unable to add data\r\nit is aready exist in your database! ");
      }

    }

    function remove() {

      var request = db.transaction(["customers"], "readwrite")
        .objectStore("customers")
        .delete("00-03");
      request.onsuccess = function(event) {
        alert("entry has been removed from your database.");
      };
    }
    function etc(){
      var str = localStorage.getItem("starScore");
      alert(str);
      add(str);
    }

  </script>
  <script src="http://code.jquery.com/jquery-3.3.1.min.js"></script>
  <script>
  $(document).ready(function() {
    readAll();
  });
  </script>
</head>

<body>
  <button onclick="read('00-03')">Read single data from indexedDb</button>
  <button onclick="readAll()">Read all data from indexedDb</button>
  <button onclick="etc()">Add data to indexedDb</button>
  <button onclick="remove()">Delete data from indexedDb</button>
  <a href="test3.html">click</a>

</body>

</html>
